<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Beginner’s cookbook &#8212; capytaine 2.3.dev documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css?v=e9a64e30" />
    <script src="../_static/documentation_options.js?v=7906c0ec"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/proof.js?v=41e9dd12"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Intermediate cookbook" href="B_intermediate_cookbook.html" />
    <link rel="prev" title="Example scripts" href="index.html" />
    <script defer data-domain="capytaine.github.io" src="https://plausible.io/js/script.js"></script>
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  


  </head><body>
  

    <div class="document">
<div id="new-doc-warning-banner" style="width:100%; background-color:#ADD8E6; text-align: center;">This page is part of the documentation of the development version 2.3 of Capytaine.<br><a href="https://capytaine.github.io/stable/">Latest stable version is available here.</a></div>
    
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="beginner-s-cookbook">
<h1><a class="toc-backref" href="#id1" role="doc-backlink">Beginner’s cookbook</a><a class="headerlink" href="#beginner-s-cookbook" title="Link to this heading">¶</a></h1>
<p>This page contains several examples of Capytaine’s main features, mostly about
the computation of added mass, radiation damping and excitation force.
The scripts can be downloaded individually as Python files from the <a class="reference external" href="https://github.com/capytaine/capytaine/tree/v2.3.dev/docs/user_manual/examples/">Github folder with examples for version 2.3.dev</a>.
See also the template in <a class="reference internal" href="../user_manual/quickstart.html"><span class="doc">Quickstart</span></a>.</p>
<nav class="contents" id="content">
<p class="topic-title">Content</p>
<ul class="simple">
<li><p><a class="reference internal" href="#beginner-s-cookbook" id="id1">Beginner’s cookbook</a></p>
<ul>
<li><p><a class="reference internal" href="#a1-added-mass-of-a-single-rigid-body" id="id2">A1. Added mass of a single rigid body</a></p></li>
<li><p><a class="reference internal" href="#a2-simulation-with-several-bodies" id="id3">A2. Simulation with several bodies</a></p></li>
<li><p><a class="reference internal" href="#a3-influence-of-the-water-depth" id="id4">A3. Influence of the water depth</a></p></li>
<li><p><a class="reference internal" href="#a4-custom-degree-of-freedom" id="id5">A4. Custom degree of freedom</a></p></li>
<li><p><a class="reference internal" href="#a5-convergence-study" id="id6">A5. Convergence study</a></p></li>
<li><p><a class="reference internal" href="#a5-forward-speed" id="id7">A5. Forward speed</a></p></li>
<li><p><a class="reference internal" href="#a6-irregular-frequencies-removal" id="id8">A6. Irregular frequencies removal</a></p></li>
<li><p><a class="reference internal" href="#a7-elastic-beam" id="id9">A7. Elastic beam</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="a1-added-mass-of-a-single-rigid-body">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">A1. Added mass of a single rigid body</a><a class="headerlink" href="#a1-added-mass-of-a-single-rigid-body" title="Link to this heading">¶</a></h2>
<p>This example generates the mesh of an horizontal cylinder, solves radiation problems for the six
rigid-body degrees of freedom and then plots the added mass.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">capytaine</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cpt</span>

<span class="n">cpt</span><span class="o">.</span><span class="n">set_logging</span><span class="p">()</span>

<span class="c1"># Generating a geometric mesh</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">mesh_horizontal_cylinder</span><span class="p">(</span>
    <span class="n">length</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
    <span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,),</span>
    <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,)</span>
<span class="p">)</span>

<span class="c1"># Define a rigid body using this mesh</span>
<span class="n">cylinder</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">FloatingBody</span><span class="p">(</span>
    <span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span>
    <span class="n">dofs</span><span class="o">=</span><span class="n">cpt</span><span class="o">.</span><span class="n">rigid_body_dofs</span><span class="p">(),</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;floating cylinder&quot;</span>
<span class="p">)</span>

<span class="c1"># Define the range of frequencies as a Numpy array</span>
<span class="n">omega_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="c1"># Set up the problems: we will solve a radiation problem for each</span>
<span class="c1"># degree of freedom of the body and for each frequency in the</span>
<span class="c1"># frequency range.</span>
<span class="n">problems</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">cpt</span><span class="o">.</span><span class="n">RadiationProblem</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">cylinder</span><span class="p">,</span> <span class="n">radiating_dof</span><span class="o">=</span><span class="n">dof</span><span class="p">,</span> <span class="n">omega</span><span class="o">=</span><span class="n">omega</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">dof</span> <span class="ow">in</span> <span class="n">cylinder</span><span class="o">.</span><span class="n">dofs</span>
    <span class="k">for</span> <span class="n">omega</span> <span class="ow">in</span> <span class="n">omega_range</span>
<span class="p">]</span>
<span class="c1"># Water density, gravity and water depth have not been specified.</span>
<span class="c1"># Default values are used.</span>

<span class="c1"># Solve all radiation problems</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">BEMSolver</span><span class="p">()</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve_all</span><span class="p">(</span><span class="n">problems</span><span class="p">)</span>

<span class="c1"># Gather the computed added mass into a labelled array.</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">assemble_dataset</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

<span class="c1"># Plot the added mass of each dofs as a function of the frequency</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="k">for</span> <span class="n">dof</span> <span class="ow">in</span> <span class="n">cylinder</span><span class="o">.</span><span class="n">dofs</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">omega_range</span><span class="p">,</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;added_mass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">radiating_dof</span><span class="o">=</span><span class="n">dof</span><span class="p">,</span> <span class="n">influenced_dof</span><span class="o">=</span><span class="n">dof</span><span class="p">),</span>
        <span class="n">label</span><span class="o">=</span><span class="n">dof</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;omega&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;added mass&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="a2-simulation-with-several-bodies">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">A2. Simulation with several bodies</a><a class="headerlink" href="#a2-simulation-with-several-bodies" title="Link to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">capytaine</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cpt</span>

<span class="c1"># Define the first body</span>
<span class="n">sphere</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">FloatingBody</span><span class="p">(</span>
        <span class="n">cpt</span><span class="o">.</span><span class="n">mesh_sphere</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">),</span>
                        <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;sphere_1&quot;</span><span class="p">)</span>
<span class="n">sphere</span><span class="o">.</span><span class="n">add_translation_dof</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Surge&quot;</span><span class="p">)</span>
<span class="n">sphere</span><span class="o">.</span><span class="n">add_translation_dof</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Heave&quot;</span><span class="p">)</span>

<span class="c1"># Define the second body</span>
<span class="n">other_sphere</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">FloatingBody</span><span class="p">(</span>
        <span class="n">cpt</span><span class="o">.</span><span class="n">mesh_sphere</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                        <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;sphere_2&quot;</span><span class="p">)</span>
<span class="n">other_sphere</span><span class="o">.</span><span class="n">add_translation_dof</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Surge&quot;</span><span class="p">)</span>
<span class="n">other_sphere</span><span class="o">.</span><span class="n">add_translation_dof</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Heave&quot;</span><span class="p">)</span>

<span class="c1"># Define the third body</span>
<span class="n">cylinder</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">FloatingBody</span><span class="p">(</span>
        <span class="n">cpt</span><span class="o">.</span><span class="n">mesh_horizontal_cylinder</span><span class="p">(</span>
            <span class="n">length</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.0</span><span class="p">),</span>
            <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cylinder&quot;</span><span class="p">)</span>
<span class="n">cylinder</span><span class="o">.</span><span class="n">add_translation_dof</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Surge&quot;</span><span class="p">)</span>
<span class="n">cylinder</span><span class="o">.</span><span class="n">add_translation_dof</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Heave&quot;</span><span class="p">)</span>

<span class="c1"># Combine the three individual bodies into a single body.</span>
<span class="n">all_bodies</span> <span class="o">=</span> <span class="n">cylinder</span> <span class="o">+</span> <span class="n">sphere</span> <span class="o">+</span> <span class="n">other_sphere</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Merged body name:&quot;</span><span class="p">,</span> <span class="n">all_bodies</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Merged body dofs:&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_bodies</span><span class="o">.</span><span class="n">dofs</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

<span class="c1"># The merged body can be used to define the problems in the usual way</span>
<span class="n">problems</span> <span class="o">=</span> <span class="p">[</span><span class="n">cpt</span><span class="o">.</span><span class="n">RadiationProblem</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">all_bodies</span><span class="p">,</span> <span class="n">radiating_dof</span><span class="o">=</span><span class="n">dof</span><span class="p">,</span> <span class="n">omega</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">dof</span> <span class="ow">in</span> <span class="n">all_bodies</span><span class="o">.</span><span class="n">dofs</span><span class="p">]</span>
<span class="n">problems</span> <span class="o">+=</span> <span class="p">[</span><span class="n">cpt</span><span class="o">.</span><span class="n">DiffractionProblem</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">all_bodies</span><span class="p">,</span> <span class="n">wave_direction</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">omega</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)]</span>

<span class="c1"># Solves the problem</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">BEMSolver</span><span class="p">()</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve_all</span><span class="p">(</span><span class="n">problems</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">assemble_dataset</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="a3-influence-of-the-water-depth">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">A3. Influence of the water depth</a><a class="headerlink" href="#a3-influence-of-the-water-depth" title="Link to this heading">¶</a></h2>
<p>This example runs the same simulation for several water depth and plot the results.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">capytaine</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cpt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">cpt</span><span class="o">.</span><span class="n">set_logging</span><span class="p">(</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>

<span class="c1"># Initialize floating body by generating a geometric mesh</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">mesh_horizontal_cylinder</span><span class="p">(</span>
    <span class="n">length</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># Dimensions</span>
    <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span>        <span class="c1"># Position</span>
    <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>    <span class="c1"># Fineness of the mesh</span>
    <span class="p">)</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">FloatingBody</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>

<span class="c1"># Define a degree of freedom. The keyword &quot;Heave&quot;</span>
<span class="c1"># is recognized by the code and the vertical translation</span>
<span class="c1"># motion is automatically defined.</span>
<span class="n">body</span><span class="o">.</span><span class="n">add_translation_dof</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Heave&quot;</span><span class="p">)</span>

<span class="c1"># Define the range of water depth</span>
<span class="n">depth_range</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>

<span class="c1"># Set up the problems: we will solve a radiation problem for each</span>
<span class="c1"># water depth:</span>
<span class="n">problems</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">cpt</span><span class="o">.</span><span class="n">RadiationProblem</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">water_depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span> <span class="n">omega</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="n">depth_range</span>
<span class="p">]</span>
<span class="c1"># Water density, gravity and radiating dof have not been specified.</span>
<span class="c1"># Default values are used. (For the radiating dof, the default value</span>
<span class="c1"># is usually the first one that has been defined. Here only one has</span>
<span class="c1"># been defined.)</span>

<span class="c1"># Solve all radiation problems</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">BEMSolver</span><span class="p">()</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve_all</span><span class="p">(</span><span class="n">problems</span><span class="p">)</span>

<span class="c1"># Gather the computed added mass into a labelled array.</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">assemble_dataset</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

<span class="c1"># Plot the added mass of each dofs as a function of the water depth.</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="s2">&quot;constrained&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">depth_range</span><span class="p">,</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;added_mass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">omega</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">radiating_dof</span><span class="o">=</span><span class="s2">&quot;Heave&quot;</span><span class="p">,</span> <span class="n">influenced_dof</span><span class="o">=</span><span class="s2">&quot;Heave&quot;</span><span class="p">),</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Finite depth&quot;</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;added_mass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">omega</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">radiating_dof</span><span class="o">=</span><span class="s2">&quot;Heave&quot;</span><span class="p">,</span> <span class="n">influenced_dof</span><span class="o">=</span><span class="s2">&quot;Heave&quot;</span><span class="p">,</span> <span class="n">water_depth</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span>
    <span class="n">xmin</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Infinite depth&quot;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Water depth&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Heave-heave added mass&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="a4-custom-degree-of-freedom">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">A4. Custom degree of freedom</a><a class="headerlink" href="#a4-custom-degree-of-freedom" title="Link to this heading">¶</a></h2>
<p>This example defines arbitrary degrees of freedom for a sphere and solves a diffraction problem.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">capytaine</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cpt</span>

<span class="c1"># Initialize floating body</span>
<span class="n">sphere</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">FloatingBody</span><span class="p">(</span>
        <span class="n">mesh</span><span class="o">=</span><span class="n">cpt</span><span class="o">.</span><span class="n">mesh_sphere</span><span class="p">(</span>
            <span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>          <span class="c1"># Dimension</span>
            <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span>   <span class="c1"># Position</span>
            <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="c1"># Fineness of the mesh</span>
            <span class="p">))</span>

<span class="c1"># DEFINE THE DOFS</span>

<span class="c1"># Manually defined heave,</span>
<span class="c1"># that is a vertical unit vector for all faces.</span>
<span class="n">sphere</span><span class="o">.</span><span class="n">dofs</span><span class="p">[</span><span class="s2">&quot;Heave&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">sphere</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Bulging of the sphere,</span>
<span class="c1"># that is a deformation vector normal to the body at all faces.</span>
<span class="c1"># We can simply point to the normal vectors of the mesh for that.</span>
<span class="n">sphere</span><span class="o">.</span><span class="n">dofs</span><span class="p">[</span><span class="s2">&quot;Bulge&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sphere</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces_normals</span>

<span class="c1"># Shearing of the sphere in the x direction.</span>
<span class="c1"># The deformation vector on a face is computed from the position of the face.</span>
<span class="n">sphere</span><span class="o">.</span><span class="n">dofs</span><span class="p">[</span><span class="s2">&quot;x-shear&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">z</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">sphere</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces_centers</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># SOLVE DIFFRACTION PROBLEMS</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">BEMSolver</span><span class="p">()</span>

<span class="c1"># Solve the problem for β=0 (incoming wave in the x direction).</span>
<span class="n">problem_1</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">DiffractionProblem</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">sphere</span><span class="p">,</span> <span class="n">wave_direction</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">omega</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">result_1</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">problem_1</span><span class="p">)</span>

<span class="c1"># Solve the problem for β=π/2 (incoming wave in the y direction).</span>
<span class="n">problem_2</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">DiffractionProblem</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">sphere</span><span class="p">,</span> <span class="n">wave_direction</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">omega</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">result_2</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">problem_2</span><span class="p">)</span>

<span class="c1"># Print the generalized diffraction forces</span>
<span class="c1"># for the three dofs we defined</span>
<span class="c1"># for both values of the wave_direction β.</span>
<span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="p">[</span><span class="n">result_1</span><span class="p">,</span> <span class="n">result_2</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Angle: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">wave_direction</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">dof</span> <span class="ow">in</span> <span class="n">sphere</span><span class="o">.</span><span class="n">dofs</span><span class="p">:</span>
        <span class="n">force</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">forces</span><span class="p">[</span><span class="n">dof</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dof</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">force</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">·exp(</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">force</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">i) N&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
</pre></div>
</div>
<p>The diffraction force on the “Heave” and “Bulge” dofs should be the same for both incoming wave directions.
The diffraction force on the “x-shear” dof is zero when the wave comes from the y direction.</p>
</section>
<section id="a5-convergence-study">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">A5. Convergence study</a><a class="headerlink" href="#a5-convergence-study" title="Link to this heading">¶</a></h2>
<p>This example runs a mesh convergence study for a submerged cylinder.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">pi</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">capytaine</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cpt</span>

<span class="n">cpt</span><span class="o">.</span><span class="n">set_logging</span><span class="p">(</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">make_cylinder</span><span class="p">(</span><span class="n">resolution</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make cylinder with a mesh of a given resolution in panels/meter.&quot;&quot;&quot;</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">length</span> <span class="o">=</span> <span class="mf">5.0</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">mesh_horizontal_cylinder</span><span class="p">(</span>
        <span class="n">length</span><span class="o">=</span><span class="n">length</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span>
        <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="o">*</span><span class="n">radius</span><span class="p">),</span>
        <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">resolution</span><span class="o">*</span><span class="n">radius</span><span class="p">),</span>
                    <span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">length</span><span class="o">*</span><span class="n">resolution</span><span class="p">),</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">length</span><span class="o">*</span><span class="n">resolution</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">FloatingBody</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;cylinder_</span><span class="si">{</span><span class="n">mesh</span><span class="o">.</span><span class="n">nb_faces</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Store the number of panels in the name of the body</span>
    <span class="n">body</span><span class="o">.</span><span class="n">add_translation_dof</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Heave&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">body</span>

<span class="n">test_matrix</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&#39;omega&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span>
    <span class="s1">&#39;radiating_dof&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Heave&#39;</span><span class="p">],</span>
<span class="p">})</span>

<span class="n">bodies</span> <span class="o">=</span> <span class="p">[</span><span class="n">make_cylinder</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span>
<span class="n">ds1</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">BEMSolver</span><span class="p">()</span><span class="o">.</span><span class="n">fill_dataset</span><span class="p">(</span><span class="n">test_matrix</span><span class="p">,</span> <span class="n">bodies</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">read_nb_faces_in_mesh_name</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read the name of the body to guess the resolution of the mesh.&quot;&quot;&quot;</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;nb_faces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">9</span><span class="p">:])</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;body_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;body_name&#39;</span><span class="p">]])</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">swap_dims</span><span class="p">({</span><span class="s1">&#39;body_name&#39;</span><span class="p">:</span> <span class="s1">&#39;nb_faces&#39;</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">ds</span>
<span class="n">ds1</span> <span class="o">=</span> <span class="n">read_nb_faces_in_mesh_name</span><span class="p">(</span><span class="n">ds1</span><span class="p">)</span>

<span class="n">ds1</span><span class="p">[</span><span class="s1">&#39;added_mass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;nb_faces&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="a5-forward-speed">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">A5. Forward speed</a><a class="headerlink" href="#a5-forward-speed" title="Link to this heading">¶</a></h2>
<p>TODO</p>
</section>
<section id="a6-irregular-frequencies-removal">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">A6. Irregular frequencies removal</a><a class="headerlink" href="#a6-irregular-frequencies-removal" title="Link to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">capytaine</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cpt</span>

<span class="n">cpt</span><span class="o">.</span><span class="n">set_logging</span><span class="p">(</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>

<span class="n">radius</span> <span class="o">=</span> <span class="mf">12.5</span>
<span class="n">draught</span> <span class="o">=</span> <span class="mf">37.5</span>
<span class="n">n_radius</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">n_theta</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">n_z</span> <span class="o">=</span> <span class="mi">30</span>

<span class="c1"># Define the range of frequencies to solve</span>
<span class="n">omega_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.25</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

<span class="n">solver</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">BEMSolver</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">compute_excitation_force</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">omega_range</span><span class="p">):</span>
    <span class="n">problems</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">cpt</span><span class="o">.</span><span class="n">DiffractionProblem</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">omega</span><span class="o">=</span><span class="n">omega</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">omega</span> <span class="ow">in</span> <span class="n">omega_range</span>
    <span class="p">]</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve_all</span><span class="p">(</span><span class="n">problems</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">assemble_dataset</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;excitation_force&#39;</span><span class="p">]</span>


<span class="c1"># Initialize floating body by generating a geometric mesh</span>
<span class="n">cylinder_mesh</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">mesh_vertical_cylinder</span><span class="p">(</span>
    <span class="n">length</span><span class="o">=</span><span class="n">draught</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">faces_max_radius</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">immersed_part</span><span class="p">()</span>

<span class="c1">### Body Without Lid (Body A)</span>
<span class="n">body_1</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">FloatingBody</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">cylinder_mesh</span><span class="p">)</span>
<span class="n">body_1</span><span class="o">.</span><span class="n">add_translation_dof</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Surge&quot;</span><span class="p">)</span>

<span class="c1">### Body With Lid at z = -3.699 (Body B)</span>
<span class="n">lid_mesh</span> <span class="o">=</span> <span class="n">cylinder_mesh</span><span class="o">.</span><span class="n">generate_lid</span><span class="p">(</span><span class="n">z</span><span class="o">=-</span><span class="mf">3.699</span><span class="p">)</span>
<span class="n">body_2</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">FloatingBody</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">cylinder_mesh</span><span class="p">,</span> <span class="n">lid_mesh</span><span class="o">=</span><span class="n">lid_mesh</span><span class="p">)</span>
<span class="n">body_2</span><span class="o">.</span><span class="n">add_translation_dof</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Surge&quot;</span><span class="p">)</span>

<span class="c1">### Body With Lid at z = auto (Body C)</span>
<span class="n">lid_mesh</span> <span class="o">=</span> <span class="n">cylinder_mesh</span><span class="o">.</span><span class="n">generate_lid</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">cylinder_mesh</span><span class="o">.</span><span class="n">lowest_lid_position</span><span class="p">(</span><span class="n">omega_max</span><span class="o">=</span><span class="n">omega_range</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
<span class="n">body_3</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">FloatingBody</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">cylinder_mesh</span><span class="p">,</span> <span class="n">lid_mesh</span><span class="o">=</span><span class="n">lid_mesh</span><span class="p">)</span>
<span class="n">body_3</span><span class="o">.</span><span class="n">add_translation_dof</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Surge&quot;</span><span class="p">)</span>

<span class="n">force_1</span> <span class="o">=</span> <span class="n">compute_excitation_force</span><span class="p">(</span><span class="n">body_1</span><span class="p">,</span> <span class="n">omega_range</span><span class="p">)</span>
<span class="n">force_2</span> <span class="o">=</span> <span class="n">compute_excitation_force</span><span class="p">(</span><span class="n">body_2</span><span class="p">,</span> <span class="n">omega_range</span><span class="p">)</span>
<span class="n">force_3</span> <span class="o">=</span> <span class="n">compute_excitation_force</span><span class="p">(</span><span class="n">body_3</span><span class="p">,</span> <span class="n">omega_range</span><span class="p">)</span>

<span class="c1"># Plot the added mass of each dofs as a function of the frequency</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">omega_range</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">force_1</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">influenced_dof</span><span class="o">=</span><span class="s1">&#39;Surge&#39;</span><span class="p">)),</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;no lid&#39;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">omega_range</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">force_2</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">influenced_dof</span><span class="o">=</span><span class="s1">&#39;Surge&#39;</span><span class="p">)),</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$z = -3.699$m&#39;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">omega_range</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">force_3</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">influenced_dof</span><span class="o">=</span><span class="s1">&#39;Surge&#39;</span><span class="p">)),</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\omega$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$F_1 (abs)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="a7-elastic-beam">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">A7. Elastic beam</a><a class="headerlink" href="#a7-elastic-beam" title="Link to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">capytaine</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cpt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">newton</span>

<span class="c1"># We consider a vertical cylinder clamped at the sea bottom and freely moving at the top above the free surface.</span>

<span class="n">water_depth</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">cylinder_length</span> <span class="o">=</span> <span class="mf">12.0</span>
<span class="n">cylinder_density</span> <span class="o">=</span> <span class="mf">1000.0</span>
<span class="n">cylinder_diameter</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">young_modulus</span> <span class="o">=</span> <span class="mf">1e9</span>
<span class="n">inertia_moment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">cylinder_diameter</span><span class="o">**</span><span class="mi">4</span> <span class="o">/</span> <span class="mi">64</span>  <span class="c1"># Cylinder with circular section</span>

<span class="c1"># The following code computes the shapes of the deformation modes of the body and the associated eigenfrequencies.</span>

<span class="k">def</span><span class="w"> </span><span class="nf">deformation_mode</span><span class="p">(</span><span class="n">i_mode</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">newton</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i_mode</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">coeff</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="n">alpha</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">alpha</span><span class="p">))</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">/</span><span class="n">cylinder_length</span>
    <span class="n">z_</span> <span class="o">=</span> <span class="n">z</span> <span class="o">+</span> <span class="n">water_depth</span>
    <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">z_</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">z_</span><span class="p">)</span> <span class="o">+</span> <span class="n">coeff</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">z_</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">z_</span><span class="p">)))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">eigenfrequency</span><span class="p">(</span><span class="n">i_mode</span><span class="p">):</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">newton</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i_mode</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">alpha</span><span class="o">/</span><span class="n">cylinder_length</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">young_modulus</span><span class="o">*</span><span class="n">inertia_moment</span><span class="o">/</span><span class="p">(</span><span class="n">cylinder_density</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">cylinder_diameter</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>


<span class="c1"># Plotting the x-deformation of the first 4 modes</span>
<span class="n">z_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">water_depth</span><span class="p">,</span> <span class="o">-</span><span class="n">water_depth</span> <span class="o">+</span> <span class="n">cylinder_length</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># for i_mode in range(4):</span>
<span class="c1">#     plt.plot(deformation_mode(i_mode, z_range), z_range, label=f&quot;mode_{i_mode}&quot;)</span>
<span class="c1"># plt.legend()</span>


<span class="n">mesh</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">mesh_vertical_cylinder</span><span class="p">(</span>
        <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">cylinder_length</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">water_depth</span> <span class="o">-</span> <span class="mf">0.1</span><span class="p">),</span>
        <span class="n">length</span><span class="o">=</span><span class="n">cylinder_length</span><span class="p">,</span>
        <span class="n">radius</span><span class="o">=</span><span class="n">cylinder_diameter</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">36</span><span class="p">),</span>
        <span class="p">)</span>

<span class="n">nb_modes</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">dofs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_modes</span><span class="p">):</span>
    <span class="n">dofs</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;mode_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">deformation_mode</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">z</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">mesh</span><span class="o">.</span><span class="n">faces_centers</span><span class="p">])</span>

<span class="n">full_body</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">FloatingBody</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">dofs</span><span class="o">=</span><span class="n">dofs</span><span class="p">,</span> <span class="n">center_of_mass</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cylinder_length</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">water_depth</span><span class="p">))</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">full_body</span><span class="o">.</span><span class="n">immersed_part</span><span class="p">(</span><span class="n">water_depth</span><span class="o">=</span><span class="n">water_depth</span><span class="p">)</span>

<span class="n">body</span><span class="o">.</span><span class="n">inertia_matrix</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">add_dofs_labels_to_matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">nb_modes</span><span class="p">))</span>
<span class="n">body</span><span class="o">.</span><span class="n">internal_stiffness_matrix</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">add_dofs_labels_to_matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="n">eigenfrequency</span><span class="p">(</span><span class="n">i_mode</span><span class="p">)</span> <span class="k">for</span> <span class="n">i_mode</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_modes</span><span class="p">)]))</span>
<span class="n">body</span><span class="o">.</span><span class="n">hydrostatic_stiffness</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">compute_hydrostatic_stiffness</span><span class="p">()</span>

<span class="n">test_matrix</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">&quot;omega&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span>
    <span class="s2">&quot;radiating_dof&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">dofs</span><span class="p">),</span>
    <span class="s2">&quot;wave_direction&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">],</span>
    <span class="s2">&quot;water_depth&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">water_depth</span><span class="p">],</span>
    <span class="p">})</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">BEMSolver</span><span class="p">()</span><span class="o">.</span><span class="n">fill_dataset</span><span class="p">(</span><span class="n">test_matrix</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
<span class="n">rao</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">post_pro</span><span class="o">.</span><span class="n">rao</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">stiffness</span><span class="o">=</span><span class="n">body</span><span class="o">.</span><span class="n">internal_stiffness_matrix</span><span class="p">)</span>


<span class="n">deformation_profile</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
    <span class="n">rao</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">radiating_dof</span><span class="o">=</span><span class="n">i_mode</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">deformation_mode</span><span class="p">(</span><span class="n">i_mode</span><span class="p">,</span> <span class="n">z_range</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i_mode</span><span class="p">,</span> <span class="n">dof</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">dofs</span><span class="p">)</span>
    <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">deformation_profile</span><span class="p">),</span> <span class="n">z_range</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>

      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">capytaine</a></h1>



<p class="blurb">a Python-based linear potential flow BEM solver</p>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../features.html">Features</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/index.html">User manual</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Example scripts</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Beginner’s cookbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="B_intermediate_cookbook.html">Intermediate cookbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="C_advanced_cookbook.html">Advanced cookbook</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developer_manual/index.html">Developer manual</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../theory_manual/index.html">Theory manual</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../citing.html">Citing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Example scripts</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Example scripts</a></li>
      <li>Next: <a href="B_intermediate_cookbook.html" title="next chapter">Intermediate cookbook</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Matthieu Ancellin.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/examples/A_beginners_cookbook.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>