<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Intermediate cookbook &#8212; capytaine 2.3.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <script src="../_static/documentation_options.js?v=67b02a41"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Advanced cookbook" href="C_advanced_cookbook.html" />
    <link rel="prev" title="Beginner’s cookbook" href="A_beginners_cookbook.html" />
    <script defer data-domain="capytaine.github.io" src="https://plausible.io/js/script.js"></script>
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  


  </head><body>
  

    <div class="document">
    
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="intermediate-cookbook">
<h1><a class="toc-backref" href="#id1" role="doc-backlink">Intermediate cookbook</a><a class="headerlink" href="#intermediate-cookbook" title="Link to this heading">¶</a></h1>
<p>This page contains several examples of Capytaine’s features, mostly focused on
post-processing features such as reconstruction of the free surface elevation
or computation of the Kochin functions.
The scripts can be downloaded individually as Python files from the <a class="reference external" href="https://github.com/capytaine/capytaine/tree/v2.3.1/docs/user_manual/examples/">Github folder with examples for version 2.3.1</a>.</p>
<nav class="contents" id="content">
<p class="topic-title">Content</p>
<ul class="simple">
<li><p><a class="reference internal" href="#intermediate-cookbook" id="id1">Intermediate cookbook</a></p>
<ul>
<li><p><a class="reference internal" href="#b1-plot-pressure-on-hull" id="id2">B1. Plot pressure on hull</a></p></li>
<li><p><a class="reference internal" href="#b2-haskind-s-relation" id="id3">B2. Haskind’s relation</a></p></li>
<li><p><a class="reference internal" href="#b3-free-surface-elevation" id="id4">B3. Free surface elevation</a></p></li>
<li><p><a class="reference internal" href="#b4-kochin-function" id="id5">B4. Kochin function</a></p></li>
<li><p><a class="reference internal" href="#b5-plot-velocity-in-domain" id="id6">B5. Plot velocity in domain</a></p></li>
<li><p><a class="reference internal" href="#b6-animated-free-surface-elevation" id="id7">B6. Animated free surface elevation</a></p></li>
<li><p><a class="reference internal" href="#b7-animation-of-the-rao" id="id8">B7. Animation of the RAO</a></p></li>
<li><p><a class="reference internal" href="#b8-pressure-field-for-zero-or-infinite-frequency" id="id9">B8. Pressure field for zero or infinite frequency</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="b1-plot-pressure-on-hull">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">B1. Plot pressure on hull</a><a class="headerlink" href="#b1-plot-pressure-on-hull" title="Link to this heading">¶</a></h2>
<p>This example solves a BEM problem and display the computed pressure on the hull
on a 3D view of the mesh.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">capytaine</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cpt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">mesh</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">mesh_sphere</span><span class="p">(</span><span class="n">faces_max_radius</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span><span class="o">.</span><span class="n">immersed_part</span><span class="p">()</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">FloatingBody</span><span class="p">(</span>
    <span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span>
    <span class="n">dofs</span><span class="o">=</span><span class="n">cpt</span><span class="o">.</span><span class="n">rigid_body_dofs</span><span class="p">(</span><span class="n">rotation_center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="p">)</span>

<span class="n">pb</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">RadiationProblem</span><span class="p">(</span><span class="n">wavelength</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">radiating_dof</span><span class="o">=</span><span class="s2">&quot;Surge&quot;</span><span class="p">,</span> <span class="n">water_depth</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">BEMSolver</span><span class="p">()</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">pb</span><span class="p">,</span> <span class="n">keep_details</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">body</span><span class="o">.</span><span class="n">show_matplotlib</span><span class="p">(</span>
        <span class="n">color_field</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">pressure</span><span class="p">),</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;viridis&quot;</span><span class="p">),</span>  <span class="c1"># Colormap</span>
        <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="b2-haskind-s-relation">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">B2. Haskind’s relation</a><a class="headerlink" href="#b2-haskind-s-relation" title="Link to this heading">¶</a></h2>
<p>This example computes the excitation force from the radiation potential
using Haskind’s relation. The result is compared with the one obtained by
direct integration of the potentials from incident waves and from the
diffraction problem.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">capytaine</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cpt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">capytaine.bem.airy_waves</span><span class="w"> </span><span class="kn">import</span> <span class="n">airy_waves_potential</span><span class="p">,</span> <span class="n">airy_waves_velocity</span><span class="p">,</span> <span class="n">froude_krylov_force</span>

<span class="n">r</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">draft</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">depth</span> <span class="o">=</span> <span class="mf">10.</span>
<span class="n">omega</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># Define geometry and heave degree of freedom</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">FloatingBody</span><span class="p">(</span>
        <span class="n">mesh</span><span class="o">=</span><span class="n">cpt</span><span class="o">.</span><span class="n">mesh_vertical_cylinder</span><span class="p">(</span>
            <span class="n">length</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">draft</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">),</span>
            <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="p">))</span>
<span class="n">body</span><span class="o">.</span><span class="n">add_translation_dof</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Heave&#39;</span><span class="p">)</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">immersed_part</span><span class="p">()</span>

<span class="n">solver</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">BEMSolver</span><span class="p">()</span>

<span class="c1"># Define and solve the diffraction and radiation problems</span>
<span class="n">diff_problem</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">DiffractionProblem</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">water_depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span>
                                      <span class="n">omega</span><span class="o">=</span><span class="n">omega</span><span class="p">,</span> <span class="n">wave_direction</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
<span class="n">rad_problem</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">RadiationProblem</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">water_depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span>
                                   <span class="n">omega</span><span class="o">=</span><span class="n">omega</span><span class="p">,</span> <span class="n">radiating_dof</span><span class="o">=</span><span class="s1">&#39;Heave&#39;</span><span class="p">)</span>

<span class="n">diff_solution</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">diff_problem</span><span class="p">)</span>
<span class="n">rad_solution</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">rad_problem</span><span class="p">)</span>


<span class="c1"># Read mesh properties</span>
<span class="n">faces_centers</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces_centers</span>
<span class="n">faces_normals</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces_normals</span>
<span class="n">faces_areas</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces_areas</span>

<span class="c1"># Computation from the diffraction solution (Capytaine)</span>
<span class="n">FK</span> <span class="o">=</span> <span class="n">froude_krylov_force</span><span class="p">(</span><span class="n">diff_problem</span><span class="p">)[</span><span class="s1">&#39;Heave&#39;</span><span class="p">]</span>
<span class="n">diff_force</span> <span class="o">=</span> <span class="n">diff_solution</span><span class="o">.</span><span class="n">forces</span><span class="p">[</span><span class="s1">&#39;Heave&#39;</span><span class="p">]</span>

<span class="c1"># Get potentials</span>
<span class="n">phi_inc</span> <span class="o">=</span> <span class="n">airy_waves_potential</span><span class="p">(</span><span class="n">faces_centers</span><span class="p">,</span> <span class="n">diff_problem</span><span class="p">)</span>
<span class="n">v_inc</span> <span class="o">=</span> <span class="n">airy_waves_velocity</span><span class="p">(</span><span class="n">faces_centers</span><span class="p">,</span> <span class="n">diff_problem</span><span class="p">)</span>
<span class="n">phi_rad</span> <span class="o">=</span> <span class="n">rad_solution</span><span class="o">.</span><span class="n">potential</span>

<span class="c1"># Indirect computation from the radiation solution, via the Haskind relation</span>
<span class="n">integrand</span> <span class="o">=</span> <span class="o">-</span> <span class="p">(</span><span class="n">phi_inc</span> <span class="o">*</span> <span class="n">faces_normals</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
              <span class="o">-</span> <span class="mi">1</span><span class="n">j</span><span class="o">/</span><span class="n">omega</span> <span class="o">*</span> <span class="n">phi_rad</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">v_inc</span><span class="nd">@faces_normals</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
<span class="n">F_hask</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">omega</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">integrand</span><span class="o">*</span><span class="n">faces_areas</span><span class="p">)</span>

<span class="c1"># Direct integration of the potentials</span>
<span class="n">diff_force_recomputed</span> <span class="o">=</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">omega</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                        <span class="n">diff_solution</span><span class="o">.</span><span class="n">potential</span><span class="o">*</span><span class="n">faces_areas</span><span class="o">*</span><span class="n">faces_normals</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">FK_recomputed</span> <span class="o">=</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">omega</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                        <span class="n">phi_inc</span><span class="o">*</span><span class="n">faces_areas</span><span class="o">*</span><span class="n">faces_normals</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Result from Capytaine = &#39;</span><span class="p">,</span> <span class="n">FK</span> <span class="o">+</span> <span class="n">diff_force</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Result from recomputed direct integration&#39;</span><span class="p">,</span>
        <span class="n">FK_recomputed</span> <span class="o">+</span> <span class="n">diff_force_recomputed</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Result from Haskind relation = &#39;</span><span class="p">,</span> <span class="n">F_hask</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="b3-free-surface-elevation">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">B3. Free surface elevation</a><a class="headerlink" href="#b3-free-surface-elevation" title="Link to this heading">¶</a></h2>
<p>This example computes the free surface elevation as a post-processing step of
a diffraction problem.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">capytaine</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cpt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">capytaine.bem.airy_waves</span><span class="w"> </span><span class="kn">import</span> <span class="n">airy_waves_free_surface_elevation</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">mesh</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">mesh_sphere</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span><span class="o">.</span><span class="n">immersed_part</span><span class="p">()</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">FloatingBody</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">dofs</span><span class="o">=</span><span class="n">cpt</span><span class="o">.</span><span class="n">rigid_body_dofs</span><span class="p">())</span>

<span class="n">pb</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">DiffractionProblem</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">wave_direction</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">BEMSolver</span><span class="p">()</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">pb</span><span class="p">)</span>

<span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<span class="n">fse</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">compute_free_surface_elevation</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
<span class="n">incoming_fse</span> <span class="o">=</span> <span class="n">airy_waves_free_surface_elevation</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">fse</span> <span class="o">+</span> <span class="n">incoming_fse</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="b4-kochin-function">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">B4. Kochin function</a><a class="headerlink" href="#b4-kochin-function" title="Link to this heading">¶</a></h2>
<p>This example computes the Kochin function for a surging buoy and plot the
results.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">pi</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">capytaine</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cpt</span>

<span class="n">cpt</span><span class="o">.</span><span class="n">set_logging</span><span class="p">(</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>

<span class="c1"># SET UP THE MESH</span>
<span class="n">buoy</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">FloatingBody</span><span class="p">(</span>
        <span class="n">mesh</span><span class="o">=</span><span class="n">cpt</span><span class="o">.</span><span class="n">mesh_vertical_cylinder</span><span class="p">(</span>
            <span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">),</span>
            <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="p">))</span>
<span class="n">buoy</span><span class="o">.</span><span class="n">add_translation_dof</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Surge&quot;</span><span class="p">)</span>

<span class="c1"># SOLVE THE BEM PROBLEMS AND COMPUTE THE KOCHIN FUNCTIONS</span>
<span class="n">theta_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
<span class="n">omega_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">test_matrix</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&#39;omega&#39;</span><span class="p">:</span> <span class="n">omega_range</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">:</span> <span class="n">theta_range</span><span class="p">,</span> <span class="s1">&#39;radiating_dof&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Surge&quot;</span><span class="p">],</span>
<span class="p">})</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">BEMSolver</span><span class="p">()</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">fill_dataset</span><span class="p">(</span><span class="n">test_matrix</span><span class="p">,</span> <span class="n">buoy</span><span class="o">.</span><span class="n">immersed_part</span><span class="p">())</span>

<span class="c1"># PLOT THE KOCHIN FUNCTION</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">swap_dims</span><span class="p">({</span><span class="s1">&#39;omega&#39;</span><span class="p">:</span> <span class="s1">&#39;wavenumber&#39;</span><span class="p">})</span>  <span class="c1"># Use wavenumber to index data</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;wavenumber&#39;</span><span class="p">]:</span>
    <span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;kochin&#39;</span><span class="p">]</span>
     <span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">radiating_dof</span><span class="o">=</span><span class="s2">&quot;Surge&quot;</span><span class="p">,</span> <span class="n">wavenumber</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
     <span class="o">.</span><span class="n">real</span>
     <span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;k=</span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> m¯¹&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Real part of the Kochin function as a function of theta&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="b5-plot-velocity-in-domain">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">B5. Plot velocity in domain</a><a class="headerlink" href="#b5-plot-velocity-in-domain" title="Link to this heading">¶</a></h2>
<p>This example reconstruct the velocity field in the domain and display it
using matplotlib.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">capytaine</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cpt</span>

<span class="c1"># Solve the potential flow problems</span>
<span class="n">radius</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">mesh_horizontal_cylinder</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span><span class="o">.</span><span class="n">immersed_part</span><span class="p">()</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">FloatingBody</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">dofs</span><span class="o">=</span><span class="n">cpt</span><span class="o">.</span><span class="n">rigid_body_dofs</span><span class="p">())</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">BEMSolver</span><span class="p">()</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve_all</span><span class="p">([</span><span class="n">cpt</span><span class="o">.</span><span class="n">RadiationProblem</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">omega</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">radiating_dof</span><span class="o">=</span><span class="n">dof</span><span class="p">)</span> <span class="k">for</span> <span class="n">dof</span> <span class="ow">in</span> <span class="n">body</span><span class="o">.</span><span class="n">dofs</span><span class="p">])</span>

<span class="c1"># Define a set of points in the fluid on which the fluid velocities will be computed</span>
<span class="n">Y</span><span class="p">,</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">3.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">Y</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">Z</span><span class="o">.</span><span class="n">ravel</span><span class="p">()])</span><span class="o">.</span><span class="n">T</span>
<span class="c1"># Filter out points that are inside the floating body</span>
<span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="n">points</span> <span class="k">if</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="n">radius</span><span class="o">**</span><span class="mi">2</span><span class="p">])</span>

<span class="c1"># Compute the velocity field for each of the result object, that is each of the radiating dof</span>
<span class="n">velocities</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="n">velocities</span><span class="p">[</span><span class="n">res</span><span class="o">.</span><span class="n">radiating_dof</span><span class="p">]</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">compute_velocity</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">dof</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="p">[</span><span class="s2">&quot;Sway&quot;</span><span class="p">,</span> <span class="s2">&quot;Heave&quot;</span><span class="p">]):</span>
    <span class="c1"># Display the arrows of the velocity</span>
    <span class="n">y_velocities</span> <span class="o">=</span> <span class="o">-</span><span class="n">velocities</span><span class="p">[</span><span class="n">dof</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">z_velocities</span> <span class="o">=</span> <span class="o">-</span><span class="n">velocities</span><span class="p">[</span><span class="n">dof</span><span class="p">][:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">points</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">y_velocities</span><span class="p">,</span> <span class="n">z_velocities</span><span class="p">,</span> <span class="n">angles</span><span class="o">=</span><span class="s2">&quot;xy&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="c1"># Display the boundary of the floating body</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">radius</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">dof</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="b6-animated-free-surface-elevation">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">B6. Animated free surface elevation</a><a class="headerlink" href="#b6-animated-free-surface-elevation" title="Link to this heading">¶</a></h2>
<p>This example solves a diffraction problem, it computes the free surface
elevation and shows it as a 3D animation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">capytaine</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cpt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">capytaine.bem.airy_waves</span><span class="w"> </span><span class="kn">import</span> <span class="n">airy_waves_free_surface_elevation</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">capytaine.ui.vtk.animation</span><span class="w"> </span><span class="kn">import</span> <span class="n">Animation</span>

<span class="n">cpt</span><span class="o">.</span><span class="n">set_logging</span><span class="p">(</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>

<span class="c1"># Generate the mesh of a sphere</span>

<span class="n">full_mesh</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">mesh_sphere</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<span class="n">full_sphere</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">FloatingBody</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">full_mesh</span><span class="p">)</span>
<span class="n">full_sphere</span><span class="o">.</span><span class="n">add_translation_dof</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Heave&quot;</span><span class="p">)</span>

<span class="c1"># Keep only the immersed part of the mesh</span>
<span class="n">sphere</span> <span class="o">=</span> <span class="n">full_sphere</span><span class="o">.</span><span class="n">immersed_part</span><span class="p">()</span>

<span class="c1"># Set up and solve problem</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">BEMSolver</span><span class="p">()</span>

<span class="n">diffraction_problem</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">DiffractionProblem</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">sphere</span><span class="p">,</span> <span class="n">wave_direction</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">omega</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
<span class="n">diffraction_result</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">diffraction_problem</span><span class="p">)</span>

<span class="n">radiation_problem</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">RadiationProblem</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">sphere</span><span class="p">,</span> <span class="n">radiating_dof</span><span class="o">=</span><span class="s2">&quot;Heave&quot;</span><span class="p">,</span> <span class="n">omega</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
<span class="n">radiation_result</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">radiation_problem</span><span class="p">)</span>

<span class="c1"># Define a mesh of the free surface and compute the free surface elevation</span>
<span class="n">free_surface</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">FreeSurface</span><span class="p">(</span><span class="n">x_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">y_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">nx</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">diffraction_elevation_at_faces</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">compute_free_surface_elevation</span><span class="p">(</span><span class="n">free_surface</span><span class="p">,</span> <span class="n">diffraction_result</span><span class="p">)</span>
<span class="n">radiation_elevation_at_faces</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">compute_free_surface_elevation</span><span class="p">(</span><span class="n">free_surface</span><span class="p">,</span> <span class="n">radiation_result</span><span class="p">)</span>

<span class="c1"># Add incoming waves</span>
<span class="n">diffraction_elevation_at_faces</span> <span class="o">=</span> <span class="n">diffraction_elevation_at_faces</span> <span class="o">+</span> <span class="n">airy_waves_free_surface_elevation</span><span class="p">(</span><span class="n">free_surface</span><span class="p">,</span> <span class="n">diffraction_problem</span><span class="p">)</span>

<span class="c1"># Run the animations</span>
<span class="n">animation</span> <span class="o">=</span> <span class="n">Animation</span><span class="p">(</span><span class="n">loop_duration</span><span class="o">=</span><span class="n">diffraction_result</span><span class="o">.</span><span class="n">period</span><span class="p">)</span>
<span class="n">animation</span><span class="o">.</span><span class="n">add_body</span><span class="p">(</span><span class="n">full_sphere</span><span class="p">,</span> <span class="n">faces_motion</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">animation</span><span class="o">.</span><span class="n">add_free_surface</span><span class="p">(</span><span class="n">free_surface</span><span class="p">,</span> <span class="n">faces_elevation</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="n">diffraction_elevation_at_faces</span><span class="p">)</span>
<span class="n">animation</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">camera_position</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>  <span class="c1"># The camera is oriented towards (0, 0, 0) by default.</span>
<span class="c1"># animation.save(&quot;path/to/the/video/file.ogv&quot;, camera_position=(-30, -30, 30))</span>

<span class="n">animation</span> <span class="o">=</span> <span class="n">Animation</span><span class="p">(</span><span class="n">loop_duration</span><span class="o">=</span><span class="n">radiation_result</span><span class="o">.</span><span class="n">period</span><span class="p">)</span>
<span class="n">animation</span><span class="o">.</span><span class="n">add_body</span><span class="p">(</span><span class="n">full_sphere</span><span class="p">,</span> <span class="n">faces_motion</span><span class="o">=</span><span class="n">full_sphere</span><span class="o">.</span><span class="n">dofs</span><span class="p">[</span><span class="s2">&quot;Heave&quot;</span><span class="p">])</span>
<span class="n">animation</span><span class="o">.</span><span class="n">add_free_surface</span><span class="p">(</span><span class="n">free_surface</span><span class="p">,</span> <span class="n">faces_elevation</span><span class="o">=</span><span class="mf">3.0</span><span class="o">*</span><span class="n">radiation_elevation_at_faces</span><span class="p">)</span>
<span class="n">animation</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">camera_position</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
<span class="c1"># animation.save(&quot;path/to/the/video/file.ogv&quot;, camera_position=(-30, -30, 30))</span>
</pre></div>
</div>
</section>
<section id="b7-animation-of-the-rao">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">B7. Animation of the RAO</a><a class="headerlink" href="#b7-animation-of-the-rao" title="Link to this heading">¶</a></h2>
<p>This script generates the animation of the RAO motion for a wave incoming in front of a ship,
such as the one used on the main page of this documentation.
This script requires the mesh of the ship <code class="code docutils literal notranslate"><span class="pre">boat_200.mar</span></code>. It can be
downloaded from: <a class="reference external" href="https://raw.githubusercontent.com/capytaine/capytaine/master/docs/examples/src/boat_200.mar">https://raw.githubusercontent.com/capytaine/capytaine/master/docs/examples/src/boat_200.mar</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">pi</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">capytaine</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cpt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">capytaine.bem.airy_waves</span><span class="w"> </span><span class="kn">import</span> <span class="n">airy_waves_free_surface_elevation</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">capytaine.ui.vtk</span><span class="w"> </span><span class="kn">import</span> <span class="n">Animation</span>

<span class="n">cpt</span><span class="o">.</span><span class="n">set_logging</span><span class="p">(</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>

<span class="n">bem_solver</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">BEMSolver</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">generate_boat</span><span class="p">():</span>
    <span class="n">boat_mesh</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">load_mesh</span><span class="p">(</span><span class="s2">&quot;boat_200.mar&quot;</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="s2">&quot;mar&quot;</span><span class="p">)</span>
    <span class="n">boat</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">FloatingBody</span><span class="p">(</span>
            <span class="n">mesh</span><span class="o">=</span><span class="n">boat_mesh</span><span class="p">,</span>
            <span class="n">dofs</span><span class="o">=</span><span class="n">cpt</span><span class="o">.</span><span class="n">rigid_body_dofs</span><span class="p">(</span><span class="n">rotation_center</span><span class="o">=</span><span class="n">boat_mesh</span><span class="o">.</span><span class="n">center_of_buoyancy</span><span class="p">),</span>
            <span class="n">center_of_mass</span> <span class="o">=</span> <span class="n">boat_mesh</span><span class="o">.</span><span class="n">center_of_buoyancy</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pirate ship&quot;</span>
            <span class="p">)</span>
    <span class="n">boat</span><span class="o">.</span><span class="n">inertia_matrix</span> <span class="o">=</span> <span class="n">boat</span><span class="o">.</span><span class="n">compute_rigid_body_inertia</span><span class="p">()</span> <span class="o">/</span> <span class="mi">10</span> <span class="c1"># Artificially lower to have a more appealing animation</span>
    <span class="n">boat</span><span class="o">.</span><span class="n">hydrostatic_stiffness</span> <span class="o">=</span> <span class="n">boat</span><span class="o">.</span><span class="n">immersed_part</span><span class="p">()</span><span class="o">.</span><span class="n">compute_hydrostatic_stiffness</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">boat</span>


<span class="k">def</span><span class="w"> </span><span class="nf">setup_animation</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">wave_amplitude</span><span class="p">,</span> <span class="n">wave_direction</span><span class="p">):</span>
    <span class="c1"># SOLVE BEM PROBLEMS</span>
    <span class="n">radiation_problems</span> <span class="o">=</span> <span class="p">[</span><span class="n">cpt</span><span class="o">.</span><span class="n">RadiationProblem</span><span class="p">(</span><span class="n">omega</span><span class="o">=</span><span class="n">omega</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="o">.</span><span class="n">immersed_part</span><span class="p">(),</span> <span class="n">radiating_dof</span><span class="o">=</span><span class="n">dof</span><span class="p">)</span> <span class="k">for</span> <span class="n">dof</span> <span class="ow">in</span> <span class="n">body</span><span class="o">.</span><span class="n">dofs</span><span class="p">]</span>
    <span class="n">radiation_results</span> <span class="o">=</span> <span class="n">bem_solver</span><span class="o">.</span><span class="n">solve_all</span><span class="p">(</span><span class="n">radiation_problems</span><span class="p">)</span>
    <span class="n">diffraction_problem</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">DiffractionProblem</span><span class="p">(</span><span class="n">omega</span><span class="o">=</span><span class="n">omega</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="o">.</span><span class="n">immersed_part</span><span class="p">(),</span> <span class="n">wave_direction</span><span class="o">=</span><span class="n">wave_direction</span><span class="p">)</span>
    <span class="n">diffraction_result</span> <span class="o">=</span> <span class="n">bem_solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">diffraction_problem</span><span class="p">)</span>

    <span class="n">dataset</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">assemble_dataset</span><span class="p">(</span><span class="n">radiation_results</span> <span class="o">+</span> <span class="p">[</span><span class="n">diffraction_result</span><span class="p">])</span>
    <span class="n">rao</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">post_pro</span><span class="o">.</span><span class="n">rao</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">wave_direction</span><span class="o">=</span><span class="n">wave_direction</span><span class="p">)</span>

    <span class="c1"># COMPUTE FREE SURFACE ELEVATION</span>
    <span class="c1"># Compute the diffracted wave pattern</span>
    <span class="n">incoming_waves_elevation</span> <span class="o">=</span> <span class="n">airy_waves_free_surface_elevation</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">diffraction_result</span><span class="p">)</span>
    <span class="n">diffraction_elevation</span> <span class="o">=</span> <span class="n">bem_solver</span><span class="o">.</span><span class="n">compute_free_surface_elevation</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">diffraction_result</span><span class="p">)</span>

    <span class="c1"># Compute the wave pattern radiated by the RAO</span>
    <span class="n">radiation_elevations_per_dof</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">radiating_dof</span><span class="p">:</span> <span class="n">bem_solver</span><span class="o">.</span><span class="n">compute_free_surface_elevation</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">radiation_results</span><span class="p">}</span>
    <span class="n">radiation_elevation</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">rao</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">omega</span><span class="o">=</span><span class="n">omega</span><span class="p">,</span> <span class="n">radiating_dof</span><span class="o">=</span><span class="n">dof</span><span class="p">)</span><span class="o">.</span><span class="n">data</span> <span class="o">*</span> <span class="n">radiation_elevations_per_dof</span><span class="p">[</span><span class="n">dof</span><span class="p">]</span> <span class="k">for</span> <span class="n">dof</span> <span class="ow">in</span> <span class="n">body</span><span class="o">.</span><span class="n">dofs</span><span class="p">)</span>

    <span class="c1"># SET UP ANIMATION</span>
    <span class="c1"># Compute the motion of each face of the mesh for the animation</span>
    <span class="n">rao_faces_motion</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">rao</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">omega</span><span class="o">=</span><span class="n">omega</span><span class="p">,</span> <span class="n">radiating_dof</span><span class="o">=</span><span class="n">dof</span><span class="p">)</span><span class="o">.</span><span class="n">data</span> <span class="o">*</span> <span class="n">body</span><span class="o">.</span><span class="n">dofs</span><span class="p">[</span><span class="n">dof</span><span class="p">]</span> <span class="k">for</span> <span class="n">dof</span> <span class="ow">in</span> <span class="n">body</span><span class="o">.</span><span class="n">dofs</span><span class="p">)</span>

    <span class="c1"># Set up scene</span>
    <span class="n">animation</span> <span class="o">=</span> <span class="n">Animation</span><span class="p">(</span><span class="n">loop_duration</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="n">omega</span><span class="p">)</span>
    <span class="n">animation</span><span class="o">.</span><span class="n">add_body</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">faces_motion</span><span class="o">=</span><span class="n">wave_amplitude</span><span class="o">*</span><span class="n">rao_faces_motion</span><span class="p">)</span>
    <span class="n">animation</span><span class="o">.</span><span class="n">add_free_surface</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">wave_amplitude</span> <span class="o">*</span> <span class="p">(</span><span class="n">incoming_waves_elevation</span> <span class="o">+</span> <span class="n">diffraction_elevation</span> <span class="o">+</span> <span class="n">radiation_elevation</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">animation</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">generate_boat</span><span class="p">()</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">FreeSurface</span><span class="p">(</span><span class="n">x_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">75</span><span class="p">),</span> <span class="n">y_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">75</span><span class="p">),</span> <span class="n">nx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="n">anim</span> <span class="o">=</span> <span class="n">setup_animation</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">omega</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">wave_amplitude</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">wave_direction</span><span class="o">=</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">anim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">camera_position</span><span class="o">=</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
    <span class="n">anim</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;animated_boat.ogv&quot;</span><span class="p">,</span> <span class="n">camera_position</span><span class="o">=</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="b8-pressure-field-for-zero-or-infinite-frequency">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">B8. Pressure field for zero or infinite frequency</a><a class="headerlink" href="#b8-pressure-field-for-zero-or-infinite-frequency" title="Link to this heading">¶</a></h2>
<p>The computations for zero and infinite frequencies are tricky, because several magnitudes such as the pressure are zero or infinity, but they can be expressed as <span class="math notranslate nohighlight">\(\omega\)</span> or <span class="math notranslate nohighlight">\(\omega^2\)</span> times some finite value.
The example below shows an example of extracting this value.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">capytaine</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cpt</span>

<span class="c1"># Initialize an example mesh and test case.</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">mesh_sphere</span><span class="p">()</span><span class="o">.</span><span class="n">immersed_part</span><span class="p">()</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">FloatingBody</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">dofs</span><span class="o">=</span><span class="n">cpt</span><span class="o">.</span><span class="n">rigid_body_dofs</span><span class="p">(</span><span class="n">rotation_center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>

<span class="n">pb</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">RadiationProblem</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">omega</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">radiating_dof</span><span class="o">=</span><span class="s2">&quot;Heave&quot;</span><span class="p">)</span>
<span class="c1"># Zero and infinity are accepted values for &quot;omega&quot;, as well as for &quot;period&quot;, &quot;wavelength&quot; and &quot;wavenumber&quot;</span>

<span class="n">solver</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">BEMSolver</span><span class="p">()</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">pb</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Heave-heave added mass: </span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">added_mass</span><span class="p">[</span><span class="s1">&#39;Heave&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">pressure</span><span class="p">)</span>
<span class="c1"># p is a custom Python object storing the pressure on each panel</span>

<span class="n">i_panel</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Some panel for testing</span>

<span class="c1"># All pressures are actually infinite</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pressure on panel </span><span class="si">{</span><span class="n">i_panel</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i_panel</span><span class="p">]))</span>

<span class="c1"># However p/omega^2 is finite (hence the finite added mass)</span>
<span class="n">p_over_omega2</span> <span class="o">=</span> <span class="n">p</span><span class="o">/</span><span class="n">pb</span><span class="o">.</span><span class="n">omega</span><span class="o">**</span><span class="mi">2</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pressure/omega^2 on panel </span><span class="si">{</span><span class="n">i_panel</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">p_over_omega2</span><span class="p">[</span><span class="n">i_panel</span><span class="p">]</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>

      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">capytaine</a></h1>



<p class="blurb">a Python-based linear potential flow BEM solver</p>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../features.html">Features</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/index.html">User manual</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Example scripts</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="A_beginners_cookbook.html">Beginner’s cookbook</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Intermediate cookbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="C_advanced_cookbook.html">Advanced cookbook</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developer_manual/index.html">Developer manual</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../theory_manual/index.html">Theory manual</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../citing.html">Citing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Example scripts</a><ul>
      <li>Previous: <a href="A_beginners_cookbook.html" title="previous chapter">Beginner’s cookbook</a></li>
      <li>Next: <a href="C_advanced_cookbook.html" title="next chapter">Advanced cookbook</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Matthieu Ancellin.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/examples/B_intermediate_cookbook.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>