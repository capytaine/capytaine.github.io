<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Outputs &#8212; capytaine 2.2 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=12dfc556" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css?v=e9a64e30" />
    <script src="../_static/documentation_options.js?v=f35be339"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/proof.js?v=41e9dd12"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Post-processing" href="post_pro.html" />
    <link rel="prev" title="Resolution" href="resolution.html" />
    <script defer data-domain="capytaine.github.io" src="https://plausible.io/js/script.js"></script>
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  


  </head><body>
  

    <div class="document">
    
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="outputs">
<h1>Outputs<a class="headerlink" href="#outputs" title="Link to this heading">¶</a></h1>
<section id="outputs-stored-in-linearpotentialflowresult">
<h2>Outputs stored in LinearPotentialFlowResult<a class="headerlink" href="#outputs-stored-in-linearpotentialflowresult" title="Link to this heading">¶</a></h2>
<p>Each <code class="docutils literal notranslate"><span class="pre">LinearPotentialFlowResult</span></code> object contains all the data defined for the
corresponding problem:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">problem</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">DiffractionProblem</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">wave_direction</span><span class="o">=</span><span class="mf">3.14</span><span class="p">)</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">BEMSolver</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">keep_details</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">period</span><span class="p">)</span>
<span class="c1"># 1.0</span>
</pre></div>
</div>
<p>They also contain a supplementary attribute named <code class="docutils literal notranslate"><span class="pre">forces</span></code>, containing the
computed forces on the body:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">forces</span><span class="p">)</span>
<span class="c1"># {&#39;Surge&#39;: (23941.728129534735+9487.048661471363j), &#39;Sway&#39;: (-2.010438038269058e-09-2.8862814360763878e-09j), ...}</span>
</pre></div>
</div>
<p>The force is stored as Python dictionary associating a complex value in SI
units to the name of the influenced degree of freedom.
In other words, in the example code above, the <span class="math notranslate nohighlight">\(x\)</span>-component of the force
vector has magnitude 23941 Newton at <span class="math notranslate nohighlight">\(t =0\)</span>, while the
<span class="math notranslate nohighlight">\(y\)</span>-component of the force vector is negligible at all time.</p>
<p>For radiation problems, the result object also contain <code class="docutils literal notranslate"><span class="pre">added_mass</span></code> and
<code class="docutils literal notranslate"><span class="pre">radiation_damping</span></code> attributes, with the same shape of a Python dictionary.</p>
<p>It the solver was called with <code class="docutils literal notranslate"><span class="pre">keep_details=True</span></code>, the result object also
contains the potential and pressure fields on each face of the mesh of the hull:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">potential</span><span class="p">)</span>
<span class="c1"># [-1.72534485e-03+0.14128629j -3.98932611e-03+0.33387497j</span>
<span class="c1">#  -6.54135830e-03+0.54208628j ... -2.09853806e+00-0.56106653j</span>
<span class="c1">#  -2.18441640e+00-0.58402701j -2.22777755e+00-0.59562008j]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">pressure</span><span class="p">)</span>
<span class="c1"># [-1.72534485e-03+0.14128629j -3.98932611e-03+0.33387497j</span>
<span class="c1">#  -6.54135830e-03+0.54208628j ... -2.09853806e+00-0.56106653j</span>
<span class="c1">#  -2.18441640e+00-0.58402701j -2.22777755e+00-0.59562008j]</span>
</pre></div>
</div>
<p>These magnitudes are stored in an one-dimensionnal array as long as the number
of faces of the mesh, and stored in the same order as the faces in the <code class="docutils literal notranslate"><span class="pre">Mesh</span></code>
object. In other words, <code class="docutils literal notranslate"><span class="pre">result.pressure[3]</span></code> contains the pressure on the
face of center <code class="docutils literal notranslate"><span class="pre">body.mesh.faces_centers[3]</span></code>.</p>
<p>Recall that the potential and the pressure are related by <span class="math notranslate nohighlight">\(p = j \rho
\omega \Phi\)</span>, where <span class="math notranslate nohighlight">\(\rho\)</span> is the fluid density and <span class="math notranslate nohighlight">\(\omega\)</span> is the
angular frequency.</p>
<p>The potential, the pressure and the velocity in the rest of the fluid can be
computed in post-processing as described in <a class="reference internal" href="post_pro.html"><span class="doc">Post-processing</span></a>.</p>
<p>When using the indirect boundary integral equation (by default), the result
object with details also contains the distribution of sources <span class="math notranslate nohighlight">\(\sigma\)</span> on
the hull, under the same form as the potential above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">sources</span><span class="p">)</span>
<span class="c1"># [  0.0281344 -0.35719578j   0.06715056-1.34127138j</span>
<span class="c1">#    0.10891061-2.26921669j ... -13.58069557+2.13219904j</span>
<span class="c1">#  -14.13645749+2.21945488j -14.41706935+2.26351156j]</span>
</pre></div>
</div>
</section>
<section id="building-a-dataset-from-linearpotentialflowresult">
<h2>Building a dataset from LinearPotentialFlowResult<a class="headerlink" href="#building-a-dataset-from-linearpotentialflowresult" title="Link to this heading">¶</a></h2>
<p>If you have a list of <code class="code docutils literal notranslate"><span class="pre">LinearPotentialFlowResult</span></code>, you can assemble
them in a xarray dataset for a more convenient post-processing. Use the
following syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">capytaine</span> <span class="kn">import</span> <span class="n">assemble_dataset</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">assemble_dataset</span><span class="p">(</span><span class="n">list_of_results</span><span class="p">)</span>
</pre></div>
</div>
<p>If you gave a test matrix to the <code class="code docutils literal notranslate"><span class="pre">BEMSolver.fill_dataset</span></code> method, the
output will directly be an xarray dataset.</p>
<p>Both <code class="code docutils literal notranslate"><span class="pre">assemble_dataset</span></code> and <code class="code docutils literal notranslate"><span class="pre">fill_dataset</span></code> accept some optional keyword
arguments to store more information in the dataset:</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">wavenumber</span></code>, <code class="code docutils literal notranslate"><span class="pre">wavelength</span></code>, <code class="code docutils literal notranslate"><span class="pre">period</span></code>, <code class="code docutils literal notranslate"><span class="pre">omega</span></code>,
(default: all <cite>True</cite>): control whether which of the representations of the
wave frequency are stored in the dataset. At least one should be included, by
default they all are.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">mesh</span></code> (default: <code class="code docutils literal notranslate"><span class="pre">False</span></code>): add some information about the mesh in
the dataset (number of faces, quadrature method).</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">hydrostatics</span></code> (default: <code class="code docutils literal notranslate"><span class="pre">True</span></code>): if hydrostatics data are
available in the <code class="code docutils literal notranslate"><span class="pre">FloatingBody</span></code>, they are added to the dataset.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The code does its best to keep the degrees of freedom in the same
order as they have been provided by the user, but there is no
guarantee that this will always be the case.
Nonetheless, in all cases the labels will always match the data.
So selecting a value by the name of the dof will always return the right one:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">radiating_dof</span><span class="o">=</span><span class="s2">&quot;Heave&quot;</span><span class="p">,</span> <span class="n">influenced_dof</span><span class="o">=</span><span class="s2">&quot;Heave&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can also manually reorder the dofs with the following syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sorted_dofs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Surge&quot;</span><span class="p">,</span> <span class="s2">&quot;Sway&quot;</span><span class="p">,</span> <span class="s2">&quot;Heave&quot;</span><span class="p">,</span> <span class="s2">&quot;Roll&quot;</span><span class="p">,</span> <span class="s2">&quot;Pitch&quot;</span><span class="p">,</span> <span class="s2">&quot;Yaw&quot;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">radiating_dof</span><span class="o">=</span><span class="n">sorted_dofs</span><span class="p">,</span> <span class="n">influenced_dof</span><span class="o">=</span><span class="n">sorted_dofs</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Datasets created with <code class="code docutils literal notranslate"><span class="pre">assemble_dataset</span></code> only include data on
cases with a free surface.
Cases without a free surface (<code class="code docutils literal notranslate"><span class="pre">free_surface=inf</span></code>) are ignored.</p>
</div>
</section>
<section id="building-a-dataset-from-bemio">
<h2>Building a dataset from Bemio<a class="headerlink" href="#building-a-dataset-from-bemio" title="Link to this heading">¶</a></h2>
<p>An xarray dataset can also be created from data structures generated using the <a class="reference external" href="https://wec-sim.github.io/bemio/">Bemio</a> package, which reads hydrodynamic output data
from NEMOH, WAMIT, and AQWA. This allows for Capytaine post-processing of hydrodynamic
data generated from other BEM codes.</p>
<p>Bemio does not come packaged with Capytaine and needs to to be installed independently.
Note that <a class="reference external" href="https://github.com/WEC-Sim/bemio/">the base repository of Bemio</a> has been
archived and is only compatible with Python 2.7.x, so using a Python 3 compatible fork is
recommended, available <a class="reference external" href="https://github.com/michaelcdevin/bemio">here</a> or installed with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">git</span><span class="o">+</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">michaelcdevin</span><span class="o">/</span><span class="n">bemio</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>To build the xarray dataset using Capytaine, the output files from the BEM program in
question must be read into a Bemio <code class="code docutils literal notranslate"><span class="pre">data_structures.ben.HydrodynamicData</span></code> class, which is
then called by <cite>assemble_dataset</cite>. For example, to create an xarray dataset from a WAMIT
<code class="code docutils literal notranslate"><span class="pre">.out</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bemio.io.wamit</span> <span class="kn">import</span> <span class="n">read</span> <span class="k">as</span> <span class="n">read_wamit</span>
<span class="kn">import</span> <span class="nn">capytaine</span> <span class="k">as</span> <span class="nn">cpt</span>
<span class="n">bemio_data</span> <span class="o">=</span> <span class="n">read_wamit</span><span class="p">(</span><span class="s2">&quot;myfile.out&quot;</span><span class="p">)</span>
<span class="n">my_dataset</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">assemble_dataset</span><span class="p">(</span><span class="n">bemio_data</span><span class="p">,</span> <span class="n">hydrostatics</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The created dataset will only contain quantities that can be directly calculated
from the values given in the original dataset. Because of this, there may be minor
differences between the variable names in an xarray dataset build with Bemio and one created
using <code class="code docutils literal notranslate"><span class="pre">LinearPotentialFlowResult</span></code>, even though the format will be identical. For
example, WAMIT <code class="code docutils literal notranslate"><span class="pre">.out</span></code> files do not contain the radii of gyration needed to calculate
the moments of inertia, so the <cite>my_dataset[‘inertia_matrix’]</cite> variable would not be included
in the above example since the rigid body mass matrix cannot be calculated.</p>
</div>
</section>
<section id="saving-the-dataset-as-netcdf-file">
<h2>Saving the dataset as NetCDF file<a class="headerlink" href="#saving-the-dataset-as-netcdf-file" title="Link to this heading">¶</a></h2>
<p>The xarray dataset produced by <code class="xref py py-func docutils literal notranslate"><span class="pre">assemble_dataset</span></code> (or <a class="reference internal" href="../developer_manual/api/capytaine.bem.solver.html#capytaine.bem.solver.BEMSolver.fill_dataset" title="capytaine.bem.solver.BEMSolver.fill_dataset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">fill_dataset</span></code></a>) has a structure close to the NetCDF file format and can easily be saved to this format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="s2">&quot;path/to/dataset.nc&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>See the <a class="reference external" href="http://xarray.pydata.org/en/stable/io.html">documentation of xarray</a> for details and options.</p>
<p>There are however a couple of issues you should be aware of:</p>
<section id="complex-numbers">
<h3>Complex numbers<a class="headerlink" href="#complex-numbers" title="Link to this heading">¶</a></h3>
<p>The netCDF standard does not handle complex numbers.
As a workaround, the complex-valued array can be saved as a bigger real-valued array with the help of the <a class="reference internal" href="../developer_manual/api/capytaine.io.xarray.html#module-capytaine.io.xarray" title="capytaine.io.xarray"><code class="xref py py-mod docutils literal notranslate"><span class="pre">capytaine.io.xarray</span></code></a> module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">capytaine.io.xarray</span> <span class="kn">import</span> <span class="n">separate_complex_values</span>
<span class="n">separate_complex_values</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="s2">&quot;path/to/dataset.nc&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The dataset can then be reloaded by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">from</span> <span class="nn">capytaine.io.xarray</span> <span class="kn">import</span> <span class="n">merge_complex_values</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">merge_complex_values</span><span class="p">(</span><span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s2">&quot;path/to/dataset.nc&quot;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="string-format">
<h3>String format<a class="headerlink" href="#string-format" title="Link to this heading">¶</a></h3>
<p>There is an issue with the handling of strings in xarray.
It affects the coordinates with strings as labels such as <code class="code docutils literal notranslate"><span class="pre">radiating_dof</span></code> and <code class="code docutils literal notranslate"><span class="pre">influenced_dof</span></code>.
They can be stored in xarray either as NetCDF string objects, which can be written in a NetCDF file, or as Python strings stored as generic Python objects, which cannot be written in a NetCDF file.
The issue is that the xarray library sometimes changes from one to the other without warnings.
It leads to the error <code class="code docutils literal notranslate"><span class="pre">ValueError:</span> <span class="pre">unsupported</span> <span class="pre">dtype</span> <span class="pre">for</span> <span class="pre">netCDF4</span> <span class="pre">variable:</span> <span class="pre">object</span></code> when trying to export a dataset.</p>
<p>This can be fixed by explicitly converting the strings to the right format when exporting the dataset:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">separate_complex_values</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span>
  <span class="s2">&quot;dataset.nc&quot;</span><span class="p">,</span>
  <span class="n">encoding</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;radiating_dof&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="s1">&#39;U&#39;</span><span class="p">},</span>
            <span class="s1">&#39;influenced_dof&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="s1">&#39;U&#39;</span><span class="p">}}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://github.com/capytaine/capytaine/issues/2">this Github issue</a>.</p>
</section>
</section>
<section id="saving-the-rotation-center-of-rigid-bodies">
<h2>Saving the rotation center of rigid bodies<a class="headerlink" href="#saving-the-rotation-center-of-rigid-bodies" title="Link to this heading">¶</a></h2>
<p>Some software downstream of Capytaine, such as <a class="reference external" href="https://github.com/BEMRosetta/BEMRosetta">BEMRosetta</a>, require the NetCDF file to store the rotation center of each body.
While this is not yet done automatically by Capytaine, it can be added to the dataset manually as in the following example, which is an extension of the <a class="reference internal" href="quickstart.html"><span class="doc">Quickstart</span></a> example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">capytaine</span> <span class="k">as</span> <span class="nn">cpt</span>

<span class="n">body_1</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">FloatingBody</span><span class="p">(</span>
            <span class="n">mesh</span><span class="o">=</span><span class="n">cpt</span><span class="o">.</span><span class="n">mesh_sphere</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
            <span class="n">dofs</span><span class="o">=</span><span class="n">cpt</span><span class="o">.</span><span class="n">rigid_body_dofs</span><span class="p">(</span><span class="n">rotation_center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
            <span class="n">center_of_mass</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;my_sphere&quot;</span><span class="p">,</span>
        <span class="p">)</span>
<span class="n">body_1</span><span class="o">.</span><span class="n">inertia_matrix</span> <span class="o">=</span> <span class="n">body_1</span><span class="o">.</span><span class="n">compute_rigid_body_inertia</span><span class="p">()</span>
<span class="n">body_1</span><span class="o">.</span><span class="n">hydrostatic_stiffness</span> <span class="o">=</span> <span class="n">body_1</span><span class="o">.</span><span class="n">immersed_part</span><span class="p">()</span><span class="o">.</span><span class="n">compute_hydrostatic_stiffness</span><span class="p">()</span>
<span class="c1"># If you have several rigid bodies, copy the code above to define &quot;body_2&quot;, &quot;body_3&quot;, etc.</span>

<span class="n">list_of_bodies</span> <span class="o">=</span> <span class="p">[</span><span class="n">body_1</span><span class="p">]</span>  <span class="c1"># Replace &quot;[body_1]&quot; by &quot;[body_1, body_2, body_3]&quot; for multibody problem.</span>

<span class="n">all_bodies</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">FloatingBody</span><span class="o">.</span><span class="n">join_bodies</span><span class="p">(</span><span class="o">*</span><span class="n">list_of_bodies</span><span class="p">)</span><span class="o">.</span><span class="n">immersed_part</span><span class="p">()</span>

<span class="c1"># Set up parameters</span>
<span class="n">test_matrix</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">({</span>
        <span class="s2">&quot;omega&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>  <span class="c1"># Can also specify &quot;period&quot;, &quot;wavelength&quot; or &quot;wavenumber&quot;</span>
        <span class="s2">&quot;wave_direction&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
        <span class="s2">&quot;radiating_dof&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_bodies</span><span class="o">.</span><span class="n">dofs</span><span class="p">),</span>
        <span class="p">})</span>

<span class="c1"># Do the resolution</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">cpt</span><span class="o">.</span><span class="n">BEMSolver</span><span class="p">()</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">fill_dataset</span><span class="p">(</span><span class="n">test_matrix</span><span class="p">,</span> <span class="n">all_bodies</span><span class="p">)</span>

<span class="n">dataset</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;rigid_body_component&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">body</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">body</span> <span class="ow">in</span> <span class="n">list_of_bodies</span><span class="p">]</span>
<span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;rotation_center&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;rigid_body_component&quot;</span><span class="p">,</span> <span class="s2">&quot;point_coordinates&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">body</span><span class="o">.</span><span class="n">rotation_center</span> <span class="k">for</span> <span class="n">body</span> <span class="ow">in</span> <span class="n">list_of_bodies</span><span class="p">])</span>
<span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;center_of_mass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;rigid_body_component&quot;</span><span class="p">,</span> <span class="s2">&quot;point_coordinates&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">body</span><span class="o">.</span><span class="n">center_of_mass</span> <span class="k">for</span> <span class="n">body</span> <span class="ow">in</span> <span class="n">list_of_bodies</span><span class="p">])</span>

<span class="c1"># Export to NetCDF file</span>
<span class="kn">from</span> <span class="nn">capytaine.io.xarray</span> <span class="kn">import</span> <span class="n">separate_complex_values</span>
<span class="n">separate_complex_values</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="s2">&quot;dataset.nc&quot;</span><span class="p">,</span>
                                           <span class="n">encoding</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;radiating_dof&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="s1">&#39;U&#39;</span><span class="p">},</span>
                                                     <span class="s1">&#39;influenced_dof&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="s1">&#39;U&#39;</span><span class="p">}})</span>
</pre></div>
</div>
<p>The support for this in Capytaine should be improved in the future.</p>
</section>
<section id="exporting-to-excel">
<h2>Exporting to Excel<a class="headerlink" href="#exporting-to-excel" title="Link to this heading">¶</a></h2>
<p>The example below uses the <code class="docutils literal notranslate"><span class="pre">openpyxl</span></code> library (that can be installed with <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">openpyxl</span></code>) to export a dataset to Excel format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="p">[[</span><span class="s2">&quot;added_mass&quot;</span><span class="p">,</span> <span class="s2">&quot;radiation_damping&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s2">&quot;radiation_data.xlsx&quot;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">capytaine.io.xarray</span> <span class="kn">import</span> <span class="n">separate_complex_values</span>
<span class="n">separate_complex_values</span><span class="p">(</span><span class="n">dataset</span><span class="p">[[</span><span class="s2">&quot;Froude_Krylov_force&quot;</span><span class="p">,</span> <span class="s2">&quot;diffraction_force&quot;</span><span class="p">]])</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s2">&quot;diffraction_data.xlsx&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>For convenience, the radiation and diffraction data have been stored in separate files.
Since this export method poorly supports complex number, the <a class="reference internal" href="../developer_manual/api/capytaine.io.xarray.html#capytaine.io.xarray.separate_complex_values" title="capytaine.io.xarray.separate_complex_values"><code class="xref py py-func docutils literal notranslate"><span class="pre">separate_complex_values</span></code></a> has been used to transform them to a pair of real numbers, as discussed for NetCDF export above.</p>
</section>
<section id="saving-the-hydrostatics-data-of-rigid-body-ies-in-nemoh-s-format">
<h2>Saving the hydrostatics data of rigid body(ies) in Nemoh’s format<a class="headerlink" href="#saving-the-hydrostatics-data-of-rigid-body-ies-in-nemoh-s-format" title="Link to this heading">¶</a></h2>
<p>For a rigid body, or a set of several rigid bodies, the following information can be saved as written by Nemoh’s and read by BEMIO to produce <code class="code docutils literal notranslate"><span class="pre">.h5</span></code> files for WEC-Sim:</p>
<ul class="simple">
<li><p>Hydrostatic stiffness matrix,</p></li>
<li><p>Centre of gravity,</p></li>
<li><p>Centre of buoyancy,</p></li>
<li><p>Displacement volume</p></li>
</ul>
<p>They are stored in two files (<code class="code docutils literal notranslate"><span class="pre">Hydrostatics.dat</span></code> and <code class="code docutils literal notranslate"><span class="pre">KH.dat</span></code>) for each body, using the following syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">capytaine.io.legacy</span> <span class="kn">import</span> <span class="n">export_hydrostatics</span>
<span class="n">export_hydrostatics</span><span class="p">(</span><span class="s2">&quot;directory_to_save_hydrostatics_data&quot;</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
</pre></div>
</div>
<p>for a single rigid body or, e.g.,:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">capytaine.io.legacy</span> <span class="kn">import</span> <span class="n">export_hydrostatics</span>
<span class="n">export_hydrostatics</span><span class="p">(</span><span class="s2">&quot;directory_to_save_hydrostatics_data&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">body_1</span><span class="p">,</span> <span class="n">body_2</span><span class="p">,</span> <span class="n">body_3</span><span class="p">])</span>
</pre></div>
</div>
<p>for several rigid bodies.</p>
<p>In order to use this function, please ensure that the body’s centre of gravity has been defined correctly and the following methods have been called on the <code class="code docutils literal notranslate"><span class="pre">FloatingBody</span></code> object before passing it to <a class="reference internal" href="../developer_manual/api/capytaine.io.legacy.html#capytaine.io.legacy.export_hydrostatics" title="capytaine.io.legacy.export_hydrostatics"><code class="xref py py-func docutils literal notranslate"><span class="pre">export_hydrostatics</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">body</span><span class="o">.</span><span class="n">add_all_rigid_body_dofs</span><span class="p">()</span>
<span class="n">body</span><span class="o">.</span><span class="n">inertia_matrix</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">compute_rigid_body_inertia</span><span class="p">()</span>
<span class="n">body</span><span class="o">.</span><span class="n">hydrostatic_stiffness</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">compute_hydrostatic_stiffness</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="saving-the-data-as-legacy-tecplot-files">
<h2>Saving the data as legacy Tecplot files<a class="headerlink" href="#saving-the-data-as-legacy-tecplot-files" title="Link to this heading">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This feature is experimental.</p>
</div>
<p>The following code will write files named <code class="code docutils literal notranslate"><span class="pre">RadiationCoefficients.tec</span></code> and <code class="code docutils literal notranslate"><span class="pre">ExcitationForce.tec</span></code> in a format matching the one of Nemoh 2.0:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">capytaine.io.legacy</span> <span class="kn">import</span> <span class="n">write_dataset_as_tecplot_files</span>
<span class="n">write_dataset_as_tecplot_files</span><span class="p">(</span><span class="s2">&quot;path/to/directory&quot;</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">capytaine</a></h1>



<p class="blurb">a Python-based linear potential flow BEM solver</p>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../features.html">Features</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installation.html">Installation for users</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="mesh.html">Meshes</a></li>
<li class="toctree-l2"><a class="reference internal" href="body.html">Floating body</a></li>
<li class="toctree-l2"><a class="reference internal" href="hydrostatics.html">Hydrostatics</a></li>
<li class="toctree-l2"><a class="reference internal" href="problem_setup.html">Setting up a problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="resolution.html">Resolution</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="post_pro.html">Post-processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="conventions.html">Conventions and differences to other codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook.html">Cookbook</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developer_manual/index.html">Developer manual</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../theory_manual/index.html">Theory manual</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../citing.html">Citing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">User manual</a><ul>
      <li>Previous: <a href="resolution.html" title="previous chapter">Resolution</a></li>
      <li>Next: <a href="post_pro.html" title="next chapter">Post-processing</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Matthieu Ancellin.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../_sources/user_manual/outputs.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>